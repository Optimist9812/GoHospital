<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cggw.forum.dao.ForumMapper">

   <!-- //获取所有帖子的消息
    List<Forum> getAllForums();-->
    <select id="getAllForums" resultType="com.cggw.forum.domain.Forum">
        select * from forum order by t_date DESC
    </select>

    <!--//创建一个帖子
    boolean insertIntoForum();-->
    <insert id="insertIntoForum" parameterType="com.cggw.forum.domain.Forum">
        insert into forum values(#{forum.tId},#{forum.id},#{forum.tTitle},#{forum.tDate},#{forum.fContent})
    </insert>


    <!--//搜索发帖人的姓名,图像 （待完成）
    Login getIdName();-->
    <select id="getIdName" >
        select u_name as name ,u_pic as pic from user1 where u_id = #{id}
        union
        select d_name as name ,d_pic as pic from doctor where d_id = #{id}
    </select>
   <!-- //搜索发帖人的评论数
    int queryCount();-->
    <select id="queryCount" resultType="java.lang.Integer">
        select count(*) from reply where t_id = #{tId}
    </select>
    <!--//获取发帖内容
    Forum getForumById(Integer fid);-->
    <select id="getForumById" resultType="java.lang.String">
          select t_content from forum where t_id = #{tId}
    </select>
    <!--//删除一个帖子
    boolean  deleteForumBytId();-->
    <delete id="deleteForumBytId" parameterType="java.lang.Integer">
        delete from forum where t_id = #{tId}
    </delete>

    <!--//发评论
    boolean  insertIntoReply();-->
    <insert id="insertIntoReply" parameterType="com.cggw.forum.domain.Reply">
          insert into reply(t_id,r_id,r_time,id,r_content,st_id) values(#{reply.tId},#{reply.rId},#{reply.rTime},#{reply.id},#{reply.rContent},#{reply.stId})
    </insert>

    <!--//删帖评论
    boolean  deleteReply();-->
    <delete id="deleteReply" parameterType="java.lang.Integer">
        delete from reply where r_id =#{rId} or st_id = #{rId}
    </delete>

    <!--//发子评论
    boolean insertIntoReplyChild();-->
    <insert id="insertIntoReplyChild" parameterType="com.cggw.forum.domain.Reply">
       insert into reply values(#{reply.tId},#{reply.rId},#{reply.rTime},#{reply.id},#{reply.stId},#{reply.rContent})
    </insert>

    <!--//删子评论
    boolean deleteReplyChild();-->
    <delete id="deleteReplyChild" parameterType="java.lang.Integer">
        delete from reply where r_id =#{rId}
    </delete>

    <!--//进入帖子后获取评论
    lsit Reply getReplyByForumId();-->
    <select id="getReplyByForumId" parameterType="java.lang.Integer" resultType="com.cggw.forum.domain.Reply">
        select * from reply where t_id = #{tId}
    </select>

</mapper>